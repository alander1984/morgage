# Инструкция пользователя #
Разработанный макет предоставляет возможность:

 - Ведение справочников
 - Регистрации и просмотра заявок
 - Формирование кредитного досье и выдачи кредита
 

Все функции доступны без авторизации, так как макет демонстрирует содержательную базовую часть операций, выполняемых при работе с заявкой/досье.

## Ведение справочников ##

В рамках макета реализовано заполнение справочников

 - Страховое обеспечение
 - Продукты
 - Опции продуктов

Для продуктов и опций предусмотрена единая форма управления содержимым
сюда вставить картинку
Для добавления продуктов и опций необходимо нажать соответствующие кнопки вверху формы

![image alt][1]

При выставлении признака "Архивный" для продукта или опции в общем реестре в справочник продуктов и опций он будет попадать в раздел "Архив", который разворачивается при нажатии на заголовок раздела.

Архивные продукты и опции недоступны для выбора в основных процессах макета, таких как выдача кредита.

Указанные справочники заполнены по умолчанию элементами с сайта дом.рф из раздела [Ипотечные продукты и опции][2]

### Страховое обеспечение ###
Справочник страхового обеспечения представляет собой классический справочник и применяется для проверки корректности выбранных опций страхования кредитного досье выбранному в рамках него кредитному продукту. 

Переход в справочник страхового обеспечения осуществляется из главного меню Справочники->Виды Страхования.

Так как в рамках макета историчность, актуальность не требуется, то актуальными и действующими видами страхования в рамках системы считаются все присутствующие в системе виды страхования.
Удаление видов страхования не допускается, если присутствуют зарегистрированные кредитные досье, использующие данные элементы.

### Добавление/редактирование продукта ###

Все поля продукта кроме "Совместимость с ипотечными опциями" и "Страховое обеспечение" являются простыми полями и разработаны в соответствии с формой карточкой продукта сайта дом.рф

Для добавления совместимых опций доступны опции без признака "Архивная". После их добавления в доступные, они удаляются из списка доступных для добавление, и наоборот, при удалении из совместимых - они возвращаются в доступные для добавления.

![image alt][8]

Продукту можно сопоставить несколько необходимых видов страхования. Для выбора доступны все элементы, находящиеся в справочнике "Виды страхования". Если для продукта уже определен выбранный в выпадающем списке вид страхования, то он не будет добавляться повторно.

### Добавление/редактирование опции ###

Опции могут быть совместимы не только с продуктами, но и с опциями, поэтому наравне с выбором совместимых с опцией продуктов для заполнения доступен выбор совместимых опций. В списке доступных опций отображаются только не архивные элементы.

## Работа с заявками ##
Для регистрации новой заявки необходимо выбрать соответствующий пункт меню из главного меню системы. Это действие выполняется при внесении данных из бумажной формы анкеты в ее электронный аналог информационной системы.

Переключение формы из расширенной в короткую согласно требованиям макета осуществляется с помощью соответствующего переключателя в правом верхнем углу формы заявки на любом этапе работы с ней. В коротком режиме доступны основные поля, доступные для запроса в БКИ, в расширенном все поля из формы заявки.

Часть полей - динамические и доступны при выборе особых условий, например

 - вид регистрации
 - адрес проживания/адрес регистрации
 - тип занятости: Иное
 - сведения о расходах заявителя: кредит/заем
 - недвижимость заявителя: вид недвижимости: иное

На основании короткой формы анкеты (3-ий раздел расширенной анкеты) при регистрации заявки в системе регистрируется физическое лицо с атрибутами, заполненными данными из заявки и между заявкой и физическим лицом создается связка 1-1.

Также в системе ведется реестр первичных кредитов (кредиты, имеющиеся у заявителя на момент подачи заявки). Для каждой заявки регистрируется основной и вторичный такие кредиты на основании данных из раздела 5. Признаком наличия действующих кредитных обязательств по заявке является значение логического поля "Кредит/заем" раздела 5.

В верхней части заявки в случае наличия действующих процессов выдачи кредита (оформленных кредитных досье). При нажатии на доступную кнопку перехода будет осуществлен переход на текущий шаг процесса выдачи кредита, связанного с данной заявкой. На одну заявку можно инициировать только один процесс выдачи. Данное ограничение не физическое (схема БД), а ограничивается логикой старта процесса выдачи (при выборе будут доступны только заявки, по которым еще не оформлены кредитные досье.

## Выдача кредита ##

Процесс выдачи кредита состоит из нескольких шагов:

 1. Выбор заявителя, заявки
 2. Выбор продукта, опций
 3. Формирование условий, выбор условий страхований
 4. Формирование и заключение договора

### 1. Выбор заявителя, заявки ###

Данный этап сделан чтобы упростить переключение, поиск и выбор заявки. Форма предусматривает предпросмотр наиболее важной информации по заявке.
Форма предусматривает множественность заявок, оформленных на одного заявителя, но в рамках макета при регистрации заявки всегда создается новый заявитель. Алгоритм унификации заявителей, признаков их идентичности необходимо проработать на этапе разработки основной системы.

![image alt][3]

Поиск реализован наиболее быстрым для оператора способом: минимизировано количество выполняемых UI-операций: поиск заявителя, к примеру, выполняется автоматически по мере ввода строки поиска. Поиск осуществляется либо по фамилии, либо по имени, либо по отчеству (вхождение).

Алгоритм поиска упрощен для целей макета.

После выбора заявки процесс формирования кредитного досье и выдачи кредита запускается при нажатии на кнопку "Перейти к выбору кредитного продукта"

### 2. Выбор продукта, опций ###

Данный шаг позволяет максимально информативно выбрать подходящий кредитный продукт и доступные опции.

![image alt][4]

В выпадающем списке для выбора доступны только активные кредитные продукты. При выборе значения из списка в правой области отображается раскрывающаяся панель с подробной информацией по выбранному продукту, а под выпадающим списком - список доступных для него кредитных опций.

Для выбора доступны несколько из совместимых кредитных опций. По мере выбора опций информация в карусели внизу формы обновляется и позволяет оперативно в экспресс режиме контролировать правильность выбираемых опций. Они листаются автоматически, либо в ручном режиме. При наведении курсора на карусель анимация прекращается и позволяет детально ознакомиться с информацией по опции. 

Наверху формы присутствуют две кнопки:

 - Заявка
 - Сохранение выбранных продуктов и опций (кнопка "Принять")

При нажатии на кнопку принять в модальном окне откроется стандартная форма заявки для просмотра подробной информации и выбора кредитного продукта на основе максимальной информации заявки.

При нажатии на кнопку принять для процесса выдачи кредита изменяется его статус и фиксируется продукт, опции, происходит переход на следующий шаг формирования кредитного досье.

### 3. Формирование условий, выбор условий страхований ###

На данном этапе оформления выдачи кредита пользователь фиксирует процентную ставку, выбирает виды страхования, сопутствующие данному кредитному досье а также формирует перечень приложенных к заявке электронных образов документов.

![image alt][7]

Виды страхования выбираются из выпадающего списка, значения для которого формируются из справочника "Виды страхования".

В информационной панели отображается информация о правильности формирования набора сопутствующих видов страхования.

Правильным считается набор видов страхования, полностью покрывающий требуемый для выбранного в рамках процесса набор видов страхования. Таким образом в рамках процесса должно быть выбраны как минимум все виды страхования, относящиеся к продукту.

Проверка корректности осуществляется автоматически при каждом изменении набора видов страхований по кредитному досье. Если набор видов страхования недостаточен, то заблокирована кнопка "Сохранить досье", которая обеспечивает переход к следующему этапу выдачи кредита - формированию и заключению договора.

В правом верхнем углу формы находится кнопка перехода к заявке. В данном случае заявка открывается не в модельном окне, а происходит переход непосредственно в заявку. Из заявки возможен переход обратно в кредитное досье.

#### Добавление файлов в кредитное досье ####

Для добавления файлов в кредитное досье используется кнопка "Прикрепить документ", которая открывает модальное окно загрузки файла. Для прикрепляемого документа можно указать наименование и примечание, которые будут привязаны к выбранному файлу.

![image alt][5]

К кредитному досье можно прикрепить неограниченное количество файлов, размер загружаемых файлов не ограничен (но естественно может быть ограничен в случае необходимости: для работы с вложениями используется gem paperclip).

### 4. Формирование и заключение договора ###

На данном этапе пользователь принимает решение о выдаче кредита, фиксирует его с помощью модального окна; кнопка "Зафиксировать решение".

![image alt][11]

В перечне документов по кредиту отображаются все электронные образы, прикрепленные на предыдущих шагах процесса, а также есть возможность прикрепить документ-решение или документ-договор. При этом название и комментарий к документу формируются автоматически.

## Дополнительные функции ##

Так как пользователи чаще всего работают с номерами заявок и ФИО заявителей, то этот поиск был вынесен в главное меню системы.

![image alt][9]

Для поиска можно вводить часть фамилии, имени или отчества или номер искомой заявки.

В результатах поиска при нажатии на пиктограмму ![image alt][10] доступен переход к соответствующей заявке.





  [1]: https://github.com/alander1984/morgage/blob/master/docs/instruction/images/prod_01.png?raw=true  
  [2]: http://xn--d1aqf.xn--p1ai/partners/general_conditions/products/
  [3]: https://github.com/alander1984/morgage/blob/master/docs/instruction/images/dos_01.png?raw=true
  [4]: https://github.com/alander1984/morgage/blob/master/docs/instruction/images/selProd01.png?raw=true
  [5]: https://github.com/alander1984/morgage/blob/master/docs/instruction/images/proc_file01.png?raw=true  
  [6]: https://github.com/alander1984/morgage/blob/master/docs/instruction/images/product01.png?raw=true 
  [7]: https://github.com/alander1984/morgage/blob/master/docs/instruction/images/proc_01.png?raw=true 
  [8]: https://github.com/alander1984/morgage/blob/master/docs/instruction/images/productEdit.png?raw=true   
  [9]: https://github.com/alander1984/morgage/blob/master/docs/instruction/images/search.png?raw=true   
  [10]: https://github.com/alander1984/morgage/blob/master/docs/instruction/images/eye.png?raw=true   
  [11]: https://github.com/alander1984/morgage/blob/master/docs/instruction/images/solution.png?raw=true   
